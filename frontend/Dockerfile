# syntax=docker/dockerfile:1.6
FROM node:20-alpine

ARG NUXT_PUBLIC_API_BASE_URL=/api/v1
ARG NUXT_PUBLIC_NEWS_LIMIT=5
ARG NUXT_PUBLIC_REFRESH_INTERVAL_MS=60000
ARG NUXT_PUBLIC_HMR_HOST=localhost
ARG NUXT_PUBLIC_HMR_PORT=80

ENV NODE_ENV=production \
    NUXT_PUBLIC_API_BASE_URL=${NUXT_PUBLIC_API_BASE_URL} \
    NUXT_PUBLIC_NEWS_LIMIT=${NUXT_PUBLIC_NEWS_LIMIT} \
    NUXT_PUBLIC_REFRESH_INTERVAL_MS=${NUXT_PUBLIC_REFRESH_INTERVAL_MS} \
    NUXT_PUBLIC_HMR_HOST=${NUXT_PUBLIC_HMR_HOST} \
    NUXT_PUBLIC_HMR_PORT=${NUXT_PUBLIC_HMR_PORT}

RUN corepack enable && corepack prepare pnpm@8.15.0 --activate

WORKDIR /app

COPY package.json ./
RUN pnpm install --prod=false

COPY . .

RUN pnpm build

EXPOSE 3000

CMD ["pnpm", "start"]
